var youstars = angular.module('youstars', [], ['$routeProvider', '$locationProvider', function ($routeProvider, $locationProvider) {
  $(document).keydown(function(e) {
    // Ctrl + H to hide UI (except player controls)
    if(e.ctrlKey) {
      if(e.keyCode === 72) {
        $('#ys-profiles, #ys-stats, #ys-content, #ys-videos, #ys-player-controls').fadeToggle();
      }
    }

    if($("#ys-overlay").is(":visible")) {
      if(e.keyCode === 27) {
        $("#ys-overlay .ys-overlay-close").trigger("click");
      }
    }

    if($("#ys-channel-overlay").is(":visible")) {
      if(e.keyCode === 27) {
        $("#ys-channel-overlay .ys-overlay-close").trigger("click");
      }
    }

    // Press left/right arrows and enter to select video from bottom list
    var highlighted = $('.ys-video-tile.currentSelection');
    if(e.keyCode === 39) {
      clearTimeout(unslide);
      if(highlighted.length && highlighted.next(".ys-video-tile").length) {
        highlighted.removeClass('slideUp currentSelection');
        var next = highlighted.next(".ys-video-tile");
        next.addClass('slideUp currentSelection');
        var unslide = setTimeout(function() {next.removeClass('slideUp')}, 3000);
        if(next.offset().left + next.width() > $(document).width()) {
          var diff = next.offset().left + next.width() - $(document).width();
          var diffdiff = next.width() - diff;
          var currScroll = $('#ys-videos').scrollLeft();
          $('#ys-videos').animate({scrollLeft: currScroll + $(document).width() - diffdiff - 7}, 500);
        }
      } else {
        highlighted.removeClass('slideUp currentSelection');
        $('.ys-video-tile').eq(0).addClass('slideUp currentSelection');
        var unslide = setTimeout(function() {$('.ys-video-tile').eq(0).removeClass('slideUp')}, 3000);
        $('#ys-videos').animate({scrollLeft: 0}, 500);
      }
    } else if(e.keyCode === 37) {
      clearTimeout(unslide);
      if(highlighted.length && highlighted.prev(".ys-video-tile").length) {
        highlighted.removeClass('slideUp currentSelection');
        var prev = highlighted.prev(".ys-video-tile");
        prev.addClass('slideUp currentSelection');
        var unslide = setTimeout(function() {prev.removeClass('slideUp')}, 3000);
        if(prev.offset().left < 0) {
          var currScroll = $('#ys-videos').scrollLeft();
          $('#ys-videos').animate({scrollLeft: currScroll - $(document).width() + 21}, 500);
        }
      } else {
        highlighted.removeClass('slideUp currentSelection');
        $('.ys-video-tile:last').addClass('slideUp currentSelection');
        var unslide = setTimeout(function() {$('.ys-video-tile:last').removeClass('slideUp')}, 3000);
        var left = $('#ys-videos .ys-video-tile').length * ($('#ys-videos .ys-video-tile:first').width() + 10);
        $('#ys-videos').animate({scrollLeft: left}, 500);
      }
    } else if(e.keyCode === 13 && highlighted.length) {
      var vid = highlighted.data('video-id');
      angular.element('body').injector().get('$rootScope').$broadcast('playVideoMayne', vid);
    }


  });
  $routeProvider.when('', {
    templateUrl: '<%= asset_path("home.html") %>',
    controller: 'homeController'
  }).when('/:currentChannel', {
    templateUrl: '<%= asset_path("index.html") %>',
    controller: 'indexController',
    reloadOnSearch: false
  })
}])
