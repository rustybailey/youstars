var youstars = angular.module('youstars', [], ['$routeProvider', '$locationProvider', function ($routeProvider, $locationProvider) {
  $(document).keydown(function(e) {
    // Ctrl + H to hide UI (except player controls)
    if(e.ctrlKey) {
      if(e.keyCode === 72) {
        $('#ys-profiles, #ys-stats, #ys-content, #ys-videos, #ys-player-controls').fadeToggle();
      }
    }

    if($("#ys-video-overlay").is(":visible")) {
      var tilePlusParent = "#ys-video-overlay .ys-recommendation";
      var tile = ".ys-recommendation";
      var tileContainer = "#ys-video-overlay .ys-recommendations";
      if(e.keyCode === 27) {
        $("#ys-video-overlay .ys-overlay-close").trigger("click");
      }
    } else if($("#ys-channel-overlay").is(":visible")) {
      var tilePlusParent = "#ys-channel-overlay .ys-recommendation";
      var tile = ".ys-recommendation";
      var tileContainer = "#ys-channel-overlay .ys-recommendations";
      if(e.keyCode === 27) {
        $("#ys-channel-overlay .ys-overlay-close").trigger("click");
      }
    } else {
      var tilePlusParent = ".ys-video-tile";
      var tile = ".ys-video-tile";
      var tileContainer = "#ys-videos";
    }

    // Press left/right arrows and enter to select video from bottom list
    var highlighted = $(tilePlusParent + '.currentSelection');
    if(e.keyCode === 39) {
      clearTimeout(unslide);
      if(highlighted.length && highlighted.next(tilePlusParent).length) {
        highlighted.removeClass('slideUp currentSelection');
        var next = highlighted.next(tilePlusParent);
        next.addClass('slideUp currentSelection');
        var unslide = setTimeout(function() {next.removeClass('slideUp')}, 3000);
        if(next.offset().left + next.width() > $(document).width()) {
          var diff = next.offset().left + next.width() - $(document).width();
          var diffdiff = next.width() - diff;
          var currScroll = $(tilePlusParent).closest(tileContainer).scrollLeft();
          $(tileContainer).animate({scrollLeft: currScroll + $(document).width() - diffdiff - 7}, 500);
        }
      } else {
        highlighted.removeClass('slideUp currentSelection');
        $(tilePlusParent).eq(0).addClass('slideUp currentSelection');
        var unslide = setTimeout(function() {$(tilePlusParent).eq(0).removeClass('slideUp')}, 3000);
        $(tileContainer).animate({scrollLeft: 0}, 500);
      }
    } else if(e.keyCode === 37) {
      clearTimeout(unslide);
      if(highlighted.length && highlighted.prev(tilePlusParent).length) {
        highlighted.removeClass('slideUp currentSelection');
        var prev = highlighted.prev(tilePlusParent);
        prev.addClass('slideUp currentSelection');
        var unslide = setTimeout(function() {prev.removeClass('slideUp')}, 3000);
        if(prev.offset().left < 0) {
          var currScroll = $(tilePlusParent).closest(tileContainer).scrollLeft();
          $(tileContainer).animate({scrollLeft: currScroll - $(document).width() + 21}, 500);
        }
      } else {
        highlighted.removeClass('slideUp currentSelection');
        $(tilePlusParent + ':last').addClass('slideUp currentSelection');
        var unslide = setTimeout(function() {$(tilePlusParent + ':last').removeClass('slideUp')}, 3000);
        var left = $(tileContainer + " " + tile).length * ($(tileContainer + " " + tile + ':first').width() + 10);
        console.log(left)
        $(tileContainer).animate({scrollLeft: left}, 500);
      }
    } else if(e.keyCode === 13 && highlighted.length) {
      var vid = highlighted.data('video-id');
      angular.element('body').injector().get('$rootScope').$broadcast('playVideoMayne', vid);
    }


  });
  $routeProvider.when('', {
    templateUrl: '<%= asset_path("home.html") %>',
    controller: 'homeController'
  }).when('/:currentChannel', {
    templateUrl: '<%= asset_path("index.html") %>',
    controller: 'indexController',
    reloadOnSearch: false
  })
}])
